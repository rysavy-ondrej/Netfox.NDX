CREATE KEYSPACE ${KEYSPACE};

USE ${KEYSPACE};

CREATE TABLE flows (
    flowId int,
    pcapUri text,
    protocol smallint, 
    sourceAddress inet, 
    destinationAddress inet, 
    sourcePort int, 
    destinationPort int,
    service text, 
    packets int, 
    bytes bigint, 
    firstSeen timestamp, 
    lastSeen timestamp,
    PRIMARY KEY ((sourceAddress, destinationAddress), sourcePort, destinationPort, protocol, flowId)
);


CREATE TYPE byteRange (
    start int,
    count int,
);

CREATE TABLE packets (
    frameNumber int,
    frameLength int,
    frameOffset bigint,
    frameTime timestamp,
    linkProtocol smallint,
    linkData byteRange,
    networkData byteRange,
    transportData byteRange,
    payloadData byteRange,
    flowId int,
    PRIMARY KEY (frameNumber)
);

CREATE INDEX packetFlowId ON packets (flowId);

